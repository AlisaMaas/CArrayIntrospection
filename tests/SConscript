########################################################################
#
#  common imports and setup for all tests
#

Import('env')
env.AppendUnique(CLANG_FLAGS='-Werror')


def RunTests(self, **kwargs):
    sources = Glob('*.c')
    for source in sources:
        bitcode = self.BitcodeSource(source)
        json = source.target_from_source('json/', '.json')
        self.IIGlueAnalyze(json, bitcode)
        actual = source.target_from_source('actualsAndExpecteds/', '.actual')
        self.RunPlugin(actual, (bitcode, json), **kwargs)
        passed = self.Expect(actual)
        Alias('test', passed)

env.AddMethod(RunTests)


########################################################################
#
#  IIGlueReader tests
#

env.RunTests(PLUGIN_ARGS='-iiglue-reader')


########################################################################
#
#  subdirectories
#

SConscript(dirs=['sentinelCheckTests'], exports='env')
#SConscript(dirs=['sentinelCheckTests','fixedLengthTests'], exports='env')

# Local variables:
# flycheck-flake8rc: "../scons-flake8.ini"
# End:
